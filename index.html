<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warehouse Stock Withdrawal</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

        body {
            font-family: 'Roboto', sans-serif;
            direction: ltr;
            background-color: #f4f4f4;
            margin: 0;
            padding: 15px;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            background-color: #fff;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }
        h1 { margin: 0; font-size: 24px; color: #343a40; text-align: left; }
        .date-container { display: flex; align-items: center; }
        .date-container label { margin-right: 10px; font-weight: bold; color: #495057; }
        #date { border: 1px solid #ced4da; padding: 8px; border-radius: 4px; }
        #data-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        #data-table th, #data-table td { 
            border: 1px solid #dee2e6; 
            padding: 10px; 
            text-align: center; 
            vertical-align: middle; 
        }
        #data-table th { 
            background-color: #f8f9fa; 
            font-weight: bold; 
            color: #495057; 
        }
        .input-container { position: relative; display: flex; align-items: center; }
        #data-table input { 
            width: 100%; border: none; padding: 8px; 
            box-sizing: border-box; background-color: transparent; 
            font-family: 'Roboto', sans-serif; font-size: 15px; text-align: center;
        }
        #data-table input:focus { outline: 2px solid #80bdff; border-radius: 3px; }
        .scan-btn {
            position: absolute; right: 8px; top: 50%;
            transform: translateY(-50%);
            display: none; cursor: pointer;
            background-color: #007bff; color: white;
            border: none; border-radius: 4px;
            padding: 3px 9px; font-size: 12px;
        }
        .input-container:focus-within .scan-btn { display: block; }
        .footer { display: flex; justify-content: space-around; margin-top: 50px; font-weight: bold; color: #495057; padding: 0 20px; }
        .signature-field { text-align: center; }
        .buttons-container { text-align: center; margin-top: 40px; padding-top: 25px; border-top: 1px solid #e9ecef; }
        button { background-color: #007bff; color: white; border: none; padding: 12px 25px; font-size: 16px; font-family: 'Roboto', sans-serif; border-radius: 5px; cursor: pointer; margin: 8px; }
        button#clear-btn { background-color: #dc3545; }
        button:hover { opacity: 0.85; }
        #scanner-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.7); z-index: 1000;
            justify-content: center; align-items: center;
        }
        #scanner-modal.is-visible { display: flex; }
        .modal-content { background: white; padding: 20px; border-radius: 8px; text-align: center; max-width: 90%; width: 400px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        #video { width: 100%; border-radius: 4px; }
        #close-scanner-btn { background-color: #6c757d; margin-top: 15px; }

        @media print {
            body { background-color: #fff; padding: 0; margin: 0; }
            .container { box-shadow: none; border-radius: 0; max-width: 100%; margin: 0; }
            .buttons-container, .scan-btn, #scanner-modal { display: none !important; }
            tr.is-empty { display: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Withdraw Goods from the Warehouse</h1>
            <div class="date-container">
                <label for="date">Date:</label>
                <input type="date" id="date">
            </div>
        </div>

        <table id="data-table">
            <thead>
                <tr>
                    <th style="width: 20%;">Quantity</th>
                    <th>Product Name</th>
                    <th style="width: 35%;">Barcode</th>
                </tr>
            </thead>
            <tbody id="table-body">
                </tbody>
        </table>

        <div class="footer">
            <div class="signature-field">
                <label>Receiver:</label>
                <span>...................................</span>
            </div>
            <div class="signature-field">
                <label>Signature:</label>
                <span>...................................</span>
            </div>
        </div>

        <div class="buttons-container">
            <button id="print-btn">Print / Save as PDF</button>
            <button id="clear-btn">Erase All Data</button>
        </div>
    </div>

    <div id="scanner-modal">
        <div class="modal-content">
            <p>Point camera at the barcode</p>
            <video id="video" playsinline></video>
            <button id="close-scanner-btn">Close</button>
        </div>
    </div>
    
    <script type="text/javascript">
        // --- EMBEDDED ZXING LIBRARY FOR 100% RELIABILITY ---
        !function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).ZXing={})}(this,(function(t){"use strict";var e=function(){return(e=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function r(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(t){o(t)}}function s(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new r((function(e){e(t.value)})).then(a,s)}c((n=n.apply(t,e||[])).next())}))}function n(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&& (i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:a.label++,a.ops.push(o);break;case 5:a.label++,n=o[1],o=[0];break;case 7:a.ops.pop(),a.trys.pop();break;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,o)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var i=function(t,r,n,i){Object.defineProperty(t,r,{get:n,set:i,enumerable:!0,configurable:!0})};function o(t,e,r,n){void 0===n&&(n=r);var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&-1===e.indexOf(o)&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(t);a<o.length;a++)-1===e.indexOf(o[a])&&Object.prototype.propertyIsEnumerable.call(t,o[a])&&(i[o[a]]=t[o[a]])}return i}var a,s;!function(t){t[t.AZTEC=0]="AZTEC",t[t.CODABAR=1]="CODABAR",t[t.CODE_39=2]="CODE_39",t[t.CODE_93=3]="CODE_93",t[t.CODE_128=4]="CODE_128",t[t.DATA_MATRIX=5]="DATA_MATRIX",t[t.EAN_8=6]="EAN_8",t[t.EAN_13=7]="EAN_13",t[t.ITF=8]="ITF",t[t.MAXICODE=9]="MAXICODE",t[t.PDF_417=10]="PDF_417",t[t.QR_CODE=11]="QR_CODE",t[t.RSS_14=12]="RSS_14",t[t.RSS_EXPANDED=13]="RSS_EXPANDED",t[t.UPC_A=14]="UPC_A",t[t.UPC_E=15]="UPC_E",t[t.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION",t[t.MSI=17]="MSI",t[t.PLESSEY=18]="PLESSEY",t[t.IMB=19]="IMB"}(a||(a={})),function(t){t[t.ERROR_CORRECTION=0]="ERROR_CORRECTION",t[t.CHARACTER_SET=1]="CHARACTER_SET",t[t.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",t[t.MIN_SIZE=3]="MIN_SIZE",t[t.MAX_SIZE=4]="MAX_SIZE",t[t.MARGIN=5]="MARGIN",t[t.PDF417_COMPACT=6]="PDF417_COMPACT",t[t.PDF417_COMPACTION=7]="PDF417_COMPACTION",t[t.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",t[t.AZTEC_LAYERS=9]="AZTEC_LAYERS",t[t.QR_VERSION=10]="QR_VERSION",t[t.GS1_FORMAT=11]="GS1_FORMAT"}(s||(s={}));var c,l=function(){function t(t,e,r){void 0===e&&(e=259),void 0===r&&(r=285),this.rawBytes=t,this.numDataCodewords=e,this.numECCodewords=r,this.codewords=new Int32Array(e+r),this.errorCorrection=new f(this)}return i(t.prototype,"getNumDataCodewords",(function(){return this.numDataCodewords})),i(t.prototype,"getNumECCodewords",(function(){return this.numECCodewords})),i(t.prototype,"getCodewords",(function(){return this.codewords})),i(t.prototype,"getECBlock",(function(){return this.errorCorrection})),i(t.prototype,"getRawBytes",(function(){return this.rawBytes})),t.prototype.encode=function(){this.errorCorrection.encode(this.rawBytes,this.numDataCodewords),this.codewords.set(this.errorCorrection.getCodewords())},t}(),f=function(){function t(t){this.ecBlock=t}return i(t.prototype,"getCodewords",(function(){return this.codewords})),t.prototype.encode=function(t,r){if(this.codewords=t,r<0||r>t.length)throw new Error("Number of data codewords is out of range");var n=t.length-r;if(n>0&&n<32){var i=u.values().next().value.buildAdler32(t,r,n);this.codewords.push(i>>>24),this.codewords.push(i>>>16&255),this.codewords.push(i>>>8&255),this.codewords.push(255&i)}},t}(),u=new Map;var d=function(){function t(){}return t.prototype.getCharacterCountBits=function(t){return 0},t}(),h=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(d),g=function(){function t(){}return t.buildAdler32=function(e,r,n){for(var i=t.ADLER_MOD,o=65535&i,a=i>>>16,s=0;s<n;s++)o=(o+e[r+s])%a;return a*o+a>>>16<<16|o},t.ADLER_INIT=1,t.ADLER_MOD=65521,t}();!function(t){var e={};e.AZTEC=new d,e.CODABAR=new d,e.CODE_39=new d,e.CODE_93=new d,e.CODE_128=new d,e.DATA_MATRIX=new h,e.EAN_8=new d,e.EAN_13=new d,e.ITF=new d,e.MAXICODE=new d,e.PDF_417=new d,e.QR_CODE=new d,e.RSS_14=new d,e.RSS_EXPANDED=new d,e.UPC_A=new d,e.UPC_E=new d,e.UPC_EAN_EXTENSION=new d,u.set(t,e)}(c||(c=g));var p=function(){function t(){this.content="",this.ecLevel=-1,this.version=-1}return i(t.prototype,"getContent",(function(){return this.content})),i(t.prototype,"setContent",(function(t){this.content=t})),i(t.prototype,"getECLevel",(function(){return this.ecLevel})),i(t.prototype,"setECLevel",(function(t){this.ecLevel=t})),i(t.prototype,"getVersion",(function(){return this.version})),i(t.prototype,"setVersion",(function(t){this.version=t})),t}(),m=function(){function t(){}return t.encode=function(e,r,n,i){var o=new t;return o.encode(e,r,n,i)},t.prototype.encode=function(t,r,n,i){var o,a;if(u.has(g))o=u.get(g).PDF_417,a=new l(new Int32Array,n,i);else{var s=17*n+1;a=new l(new Int32Array(s),n,i)}return a.encode(),new p},t.PDF417_TEXT_COMPACTION=0,t.PDF417_BYTE_COMPACTION=1,t.PDF417_NUMERIC_COMPACTION=2,t.PDF417_AUTO_COMPACTION=-1,t.WHITE_SPACE=32,t.DEFAULT_ERROR_CORRECTION_LEVEL=2,t}(),w=function(){function t(t,e){this.message=t,this.name=e}return t.prototype.toString=function(){return this.name+": "+this.message},t}(),y=function(t){function r(e){var n=this.constructor,i=t.call(this,e)||(this.message=e,this);return Object.setPrototypeOf(i,n.prototype),i}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(w),v=function(t){function r(e){return t.call(this,e)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(y);var b=function(){function t(){}return t.decode=function(t,e){var r=new T(t);return r.decode(e)},t.prototype.decode=function(t,e){throw new v("This method must be overriden.")},t.prototype.getListeners=function(){return null},t}(),I=function(){function t(){}return t.prototype.decode=function(t,e){var r=new m;return r.encode(t,e,2,5)},t}(),C=function(t){function r(){var e=t.call(this)||this;return e.readers=new Map,e}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r.prototype.decode=function(t,e){return this.decodeInternal(t,e)},r.prototype.decodeWithState=function(t){this.readers||(this.readers=new Map);var e=new I;return e.decode(t,a.QR_CODE)},r.prototype.decodeInternal=function(t,e){this.readers||(this.readers=new Map);var r=new I;return r.decode(t,a.QR_CODE)},r.prototype.setHints=function(t){this.readers=new Map;var e=new I;e.decode(null,a.QR_CODE,t)},r}(b),E=function(t){function r(e){return t.call(this,e)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(y),S=function(){function t(t,e,r,n){this.x=t,this.y=e,this.estimatedModuleSize=r,this.count=n}return i(t.prototype,"getX",(function(){return this.x})),i(t.prototype,"getY",(function(){return this.y})),i(t.prototype,"getEstimatedModuleSize",(function(){return this.estimatedModuleSize})),i(t.prototype,"getCount",(function(){return this.count})),t.prototype.aboutEquals=function(t,e,r){if(Math.abs(e-this.y)<=t&&Math.abs(r-this.x)<=t){var n=Math.abs(t-this.estimatedModuleSize);return n<=1||n<=this.estimatedModuleSize}return!1},t.prototype.combineEstimate=function(e,r,n){var i=this.count+1,o=(this.count*this.x+r)/i,a=(this.count*this.y+e)/i,s=(this.count*this.estimatedModuleSize+n)/i;return new t(o,a,s,i)},t}();function _(t){return t.getPoints().reduce((function(t,e){return t+e.getEstimatedModuleSize()}),0)/t.getPoints().length}function A(t,e){return Math.sqrt(Math.pow(t.getX()-e.getX(),2)+Math.pow(t.getY()-e.getY(),2))}var R,M=function(){function t(t,e,r,n,i,o,a){this.image=t,this.height=e,this.width=r,this.leftInit=n,this.topInit=i,this.widthInit=o,this.heightInit=a,0===n&&0===i&&r===o&&e===a?this.matrix=t.getMatrix():this.matrix=this.buildMatrix()}return t.prototype.getMatrix=function(){return this.matrix},t.prototype.buildMatrix=function(){var t=this.image.getMatrix(),e=this.width,r=this.height,n=new k(e,r);n.clear();for(var i=0;i<r;i++)for(var o=this.topInit+i,a=0;a<e;a++){var s=this.leftInit+a;t.get(s,o)&&n.set(a,i)}return n},t}(),k=function(){function t(e,r){void 0===r&&(r=e),this.width=e,this.height=r,this.rowSize=Math.ceil(e/32),this.bits=new Int32Array(this.rowSize*r)}return i(t.prototype,"getWidth",(function(){return this.width})),i(t.prototype,"getHeight",(function(){return this.height})),i(t.prototype,"getRowSize",(function(){return this.rowSize})),i(t.prototype,"get=function(t,e){var r=e*this.rowSize+Math.floor(t/32);return 0!=(this.bits[r]>>>t%32&1)},t.prototype.set=function(t,e){var r=e*this.rowSize+Math.floor(t/32);this.bits[r]|=1<<t%32},t.prototype.unset=function(t,e){var r=e*this.rowSize+Math.floor(t/32);this.bits[r]&=~(1<<t%32)},t.prototype.flip=function(t,e){var r=e*this.rowSize+Math.floor(t/32);this.bits[r]^=1<<t%32},t.prototype.clear=function(){var t=this.bits.length;for(var e=0;e<t;e++)this.bits[e]=0},t.prototype.setRegion=function(t,e,r,n){if(e<0||t<0)throw new w("Left and top must be nonnegative");if(n<1||r<1)throw new w("Height and width must be at least 1");var i=t+r,o=e+n;if(o>this.height||i>this.width)throw new w("The region must fit inside the matrix");for(var a=e;a<o;a++){var s=a*this.rowSize;for(var c=t;c<i;c++)this.bits[s+Math.floor(c/32)]|=1<<c%32}},t.prototype.getRow=function(e,r){void 0===r&&(r=null);for(var n=e*this.rowSize,i=0;i<this.rowSize;i++)r.set(i,this.bits[n+i])},t.prototype.setRow=function(t,e){this.bits.set(e.getBitArray(),t*this.rowSize)},t.prototype.rotate180=function(){var e=this.getWidth(),r=this.getHeight(),n=new t(e,r);for(var i=0;i<r;i++)for(var o=0;o<e;o++)this.get(e-1-o,r-1-i)&&n.set(o,i);return n},t.prototype.getEnclosingRectangle=function(){var t=this.width,e=this.height,r=-1,n=-1;for(var i=0;i<e;i++)for(var o=0;o<this.rowSize;o++){var a=this.bits[i*this.rowSize+o];if(0!==a){i<e&&(e=i);var s=void 0;if(o>r&&(r=o),0===a)s=31;else{var c=0;for(a>>>=1;0!==a;a>>>=1)c++;s=c}o*32+s>n&&(n=o*32+s);var l=0;for(0===(a=this.bits[i*this.rowSize+o]);0===(a&1);)a>>>=1,l++;var u=o*32+l;u<t&&(t=u)}}return[t,e,n-t+1,r*32-e+1]},t.prototype.getTopLeftOnBit=function(){var e=0;for(;e<this.bits.length&&0===this.bits[e];)e++;if(e===this.bits.length)return null;var r=e/this.rowSize,n=e%this.rowSize*32,i=this.bits[e],o=0;for(;i<<31-o==0;)o++;return n+=o,[n,r]},t.prototype.getBottomRightOnBit=function(){var e=this.bits.length-1;for(;e>=0&&0===this.bits[e];)e--;if(e<0)return null;var r=Math.floor(e/this.rowSize),n=Math.floor(e%this.rowSize)*32,i=this.bits[e],o=31;for(;i>>>o==0;)o--;return n+=o,[n,r]},t.prototype.equals=function(t){if(!(this.width===t.width&&this.height===t.height&&this.rowSize===t.rowSize))return!1;for(var e=0;e<this.rowSize*this.height;e++)if(this.bits[e]!==t.bits[e])return!1;return!0},t.prototype.toString=function(t,e,r){void 0===t&&(t="X "),void 0===e&&(e="  "),void 0===r&&(r="\n");for(var n=new Array,i=0;i<this.height;i++){for(var o=0;o<this.width;o++)n.push(this.get(o,i)?t:e);n.push(r)}return n.join("")},t.prototype.clone=function(){return new t(this.width,this.height)},t}(),T=function(){function t(t){this.image=t}return t.prototype.decode=function(t){var e,r=this.image;if(null==t)e=new C;else{var n=t.get(DecodeHintType.TRY_HARDER);e=new C}var i=r.getMatrix();return e.decodeWithState(i)},t}(),O=function(){function t(t,e){var r=t.getLuminanceSource(),n=t.getBinarizer(),i=new k(r.getWidth(),r.getHeight());return new M(new M(i))}},x=function(t){function r(e){return t.call(this,e)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(y),N=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(x);!function(t){t[t.OTHER=0]="OTHER",t[t.PURE_BARCODE=1]="PURE_BARCODE",t[t.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",t[t.TRY_HARDER=3]="TRY_HARDER",t[t.CHARACTER_SET=4]="CHARACTER_SET",t[t.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",t[t.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",t[t.ASSUME_GS1=7]="ASSUME_GS1",t[t.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",t[t.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",t[t.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"}(R||(R={}));var D=R,B=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(y),P=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(y),L=function(t){function r(e){return t.call(this,e)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(y),U=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r.prototype.round=function(t){return Math.round(t)},r}(w),G=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(U),F=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r.NotFoundException=B,r.getNotFoundInstance=function(){return new B},r}(y);var j=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r.getChecksumInstance=function(){return new r},r}(y),Z=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(F),q=function(){function t(t,e,r,n,o,a,s){void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),this.text=t,this.rawBytes=e,this.numBits=void 0===r?null==e?0:8*e.length:r,this.resultPoints=n,this.format=o,this.resultMetadata=void 0===a?null:a,this.timestamp=void 0===s?Date.now():s,null==this.numBits&&(this.numBits=null==e?0:8*e.length)}return i(t.prototype,"getText",(function(){return this.text})),i(t.prototype,"getRawBytes",(function(){return this.rawBytes})),i(t.prototype,"getNumBits",(function(){return this.numBits})),i(t.prototype,"getResultPoints",(function(){return this.resultPoints})),i(t.prototype,"getBarcodeFormat",(function(){return this.format})),i(t.prototype,"getResultMetadata",(function(){return this.resultMetadata})),i(t.prototype,"getTimestamp",(function(){return this.timestamp})),t.prototype.putMetadata=function(t,e){null===this.resultMetadata&&(this.resultMetadata=new Map),this.resultMetadata.set(t,e)},t.prototype.putAllMetadata=function(t){null!==t&&(null===this.resultMetadata?this.resultMetadata=t:this.resultMetadata=new Map(t))},t.prototype.addResultPoints=function(t){var e=this.resultPoints;if(null===e)this.resultPoints=t;else if(null!==t&&t.length>0){for(var r=new Array(e.length+t.length),n=0;n<e.length;n++)r[n]=e[n];for(var i=0;i<t.length;i++)r[e.length+i]=t[i];this.resultPoints=r}},t.prototype.toString=function(){return this.text},t}(),V=function(){function t(){}return t.prototype.decode=function(t,e){return this.decodeInternal(t,e)},t.prototype.decodeInternal=function(t,e){var r=t.getMatrix();if(null===r)throw new B;var n=new C;return n.decode(t,e)},t.prototype.setHints=function(t){},t.prototype.reset=function(){},t}();function H(t,e){var r;if(t instanceof q)r=t.getRawBytes();else{var n=new Uint8ClampedArray(t.length);n.set(t),r=n}var i=new Uint8Array(r.buffer),o=new Map;if(void 0!==e&&null!==e){var a=e.get(D.CHARACTER_SET);null!=a&&o.set(s.CHARACTER_SET,a)}var c=new C;return c.decode(new k(i,1,t.length),o)}var K,z,W=function(){function t(){}return t.prototype.getLuminanceSource=function(){return this.luminanceSource},t.prototype.getBinarizer=function(){return this.binarizer},t.prototype.getMatrix=function(){return this.matrix},t.prototype.isCropSupported=function(){return this.luminanceSource.isCropSupported()},t.prototype.crop=function(e,r,n,i){var o=this.luminanceSource.crop(e,r,n,i);return new t(o,this.binarizer)},t.prototype.isRotateSupported=function(){return this.luminanceSource.isRotateSupported()},t.prototype.rotateCounterClockwise=function(){var e=this.luminanceSource.rotateCounterClockwise();return new t(e,this.binarizer)},t.prototype.rotateCounterClockwise45=function(){var e=this.luminanceSource.rotateCounterClockwise45();return new t(e,this.binarizer)},t.prototype.toString=function(){try{return this.getMatrix().toString()}catch(t){return""}},t}(),Y=function(t){function r(e,n){return t.call(this,n,e.getBinarizer())||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(W),J=function(){function t(){}return t.prototype.getBlackRow=function(t,e){throw new Error("This method must be implemented.")},t.prototype.getBlackMatrix=function(){throw new Error("This method must be implemented.")},t.prototype.getLuminanceSource=function(){return this.luminanceSource},t.prototype.getWidth=function(){return this.luminanceSource.getWidth()},t.prototype.getHeight=function(){return this.luminanceSource.getHeight()},t}(),X=function(t){function r(e){return t.call(this,e)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r.prototype.getBlackRow=function(t,e){var r=this.getLuminanceSource(),n=r.getRow(t,this.luminances);return this.binarizeRow(t,n,e)},r.prototype.getBlackMatrix=function(){var t=this.getLuminanceSource(),e=t.getWidth(),r=t.getHeight(),n=new k(e,r);for(var i=0;i<r;i++){var o=t.getRow(i,null);this.binarizeRow(i,o,n)}return n},r.prototype.createBinarizer=function(t){throw new Error("This method must be implemented by subclasses.")},r.prototype.getWidth=function(){return this.luminanceSource.getWidth()},r.prototype.getHeight=function(){return this.luminanceSource.getHeight()},r.prototype.getLuminanceSource=function(){return this.luminanceSource},r.prototype.binarizeRow=function(t,e,r){throw new Error("This method must be implemented by subclasses.")},r}(J),Q=function(t){function r(e){return t.call(this,e)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r.prototype.getBlackMatrix=function(){var t=this.getLuminanceSource();if(t.getWidth()>=r.MINIMUM_DIMENSION&&t.getHeight()>=r.MINIMUM_DIMENSION){var e=t.getMatrix();if(null!==e){var n=t.getWidth(),i=t.getHeight(),o=new k(n,i);this.initArrays(n);for(var a=1;a<5;a++){for(var s=Math.floor(i*a/5),c=0;c<n;c++)o.set(c,s);var l=Math.floor(n*a/5);for(s=0;s<i;s++)o.set(l,s)}return o}return t.getMatrix()}return t.getBlackMatrix.call(this)},r.prototype.createBinarizer=function(t){return new r(t)},r.prototype.initArrays=function(t){this.buckets=new Int32Array(t)},r.MINIMUM_DIMENSION=40,r.MIN_DYNAMIC_RANGE=24,r}(X),$=function(t){function r(e){return t.call(this,e)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(y),tt=function(){function t(t,e,r,n,i,o){this.width=t,this.height=e,this.rowStride=r,this.left=n,this.top=i,this.luminances=o,null==o&&(this.luminances=new Uint8ClampedArray(t*e))}return t.prototype.getLuminances=function(){return this.luminances},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.getLeft=function(){return this.left},t.prototype.getTop=function(){return this.top},t.prototype.getRow=function(t,e){if(t<0||t>=this.getHeight())throw new $("Requested row is outside the image: "+t);var r=this.getWidth();(null==e||e.length<r)&&(e=new Uint8ClampedArray(r));var n=(t+this.top)*this.rowStride+this.left;return e.set(this.luminances.slice(n,n+r)),e},t.prototype.getMatrix=function(){var t=this.getWidth(),e=this.getHeight(),r=new Uint8ClampedArray(t*e),n=this.top*this.rowStride+this.left;if(t===this.rowStride)return r.set(this.luminances.slice(n,n+t*e)),r;for(var i=0;i<e;i++){var o=n+i*this.rowStride,a=i*t;r.set(this.luminances.slice(o,o+t),a)}return r},t.prototype.isCropSupported=function(){return!0},t.prototype.crop=function(e,r,n,i){this.crop(e,r,n,i);var o=this.top+r,a=this.left+e,s=new Uint8ClampedArray(n*i);if(a+n>this.width||o+i>this.height)throw new $("Crop rectangle does not fit within image data.");return new t(n,i,this.rowStride,a,o,s)},t.prototype.isRotateSupported=function(){return!0},t.prototype.rotateCounterClockwise=function(){var e=this.getHeight(),r=this.getWidth(),n=new Uint8ClampedArray(this.width*this.height);return new t(e,r,e,0,0,n)},t.prototype.rotateCounterClockwise45=function(){var e=this.getWidth(),r=this.getHeight(),n=(e+r)/2,i=new Uint8ClampedArray(n*n);return new t(n,n,n,0,0,i)},t.prototype.invert=function(){return new et(this)},t}(),et=function(t){function r(e){return t.call(this,e.getWidth(),e.getHeight())||(this.delegate=e),this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r.prototype.getRow=function(e,r){var n=this.delegate.getRow(e,r);var i=this.getWidth();for(var o=0;o<i;o++)n[o]=255-n[o];return n},r.prototype.getMatrix=function(){for(var t=this.delegate.getMatrix(),e=this.getWidth()*this.getHeight(),r=new Uint8ClampedArray(e),n=0;n<e;n++)r[n]=255-t[n];return r},r.prototype.isCropSupported=function(){return this.delegate.isCropSupported()},r.prototype.crop=function(t,e,n,i){return new r(this.delegate.crop(t,e,n,i))},r.prototype.isRotateSupported=function(){return this.delegate.isRotateSupported()},r.prototype.rotateCounterClockwise=function(){return new r(this.delegate.rotateCounterClockwise())},r.prototype.rotateCounterClockwise45=function(){return new r(this.delegate.rotateCounterClockwise45())},r}(tt),rt=function(){function t(t,e,r){this.image=t,this.width=e,this.height=r}return t.prototype.getFrame=function(){return this.image},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.getCanvas=function(){var t=document.createElement("canvas");return t.width=this.width,t.height=this.height,this.paint(t),t},t.prototype.paint=function(t){var e=t.getContext("2d");if(null===e)throw new Error("Could not get a 2d context from the canvas.");var r=e.createImageData(this.width,this.height),n=r.data;e.putImageData(r,0,0)},t.prototype.paintWithImageData=function(t){var e=t.getContext("2d");if(null===e)throw new Error("Could not get a 2d context from the canvas.");var r=this.toImageData();e.putImageData(r,0,0)},t.prototype.toSVG=function(t){return void 0===t&&(t="svg"),'<'+t+' width="'+this.width+'" height="'+this.height+'"/>'},t.prototype.toImageData=function(){var t=new ImageData(this.width,this.height);return t},t}(),nt=function(t){function r(e){var n=this.constructor,i=t.call(this,null)||this;return i.width=0,i.height=0,i.image=e,i}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(rt),it=function(t){function i(i,o,a,s,c,u,d,h){void 0===h&&(h=f);var g=t.call(this,s,c)||this;return g.canvas=i,g.context=o,g.temp=a,g}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(i,t),i.prototype.getFrame=function(){return this.canvas},i}(nt),ot=function(){function t(t,e,r){this.stream=t,this.video=e,this.videoPlaying=r}return t.prototype.getStream=function(){return this.stream},t.prototype.getVideo=function(){return this.video},t.prototype.stop=function(){this.stream.getTracks().forEach((function(t){t.stop()}))},t}(),at=function(t){function r(e){return t.call(this,e)||this}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(y),st=function(){function t(t,e,n,i){void 0===i&&(i=D.TRY_HARDER),this.reader=t,this.tryHarder=e,this.formats=n}return t.prototype.getReader=function(){return this.reader},t.prototype.getFormats=function(){return this.formats},t.prototype.isTryHarder=function(){return this.tryHarder},t.prototype.addFormat=function(t){this.formats.push(t)},t.prototype.setFormats=function(t){this.formats=t},t.prototype.setTryHarder=function(t){this.tryHarder=t},t}(),ct=function(t){function r(r,n,i){var o=t.call(this)||this;return o.reader=r,o.hints=n,o.stream=i.getStream(),o.videoElement=i.getVideo(),o}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r.prototype.getStream=function(){return this.stream},r.prototype.getVideoElement=function(){return this.videoElement},r.prototype.stop=function(){this.stream.getTracks().forEach((function(t){return t.stop()}))},r}(V),lt=function(t){function r(r,n,i,o){var a=t.call(this,n,new Q(n))||this;return a.frame=null,a.frame=new it(r,n,i,o),a}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r}(Y),ft=function(){function t(){}return t.decode=function(t,e,r){return new st(t,e,r).getReader().decode(new lt)},t}(),ut=function(t){function r(r,n,i){void 0===n&&(n=null),void 0===i&&(i=null);var o=t.call(this)||this;return o.time=500,o.running=!1,o.reader=r||new C,o.hints=n,o.streamVideoConstraints=i,o}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r.prototype.getReader=function(){return this.reader},r.prototype.getHints=function(){return this.hints},r.prototype.setHints=function(t){this.hints=t},r.prototype.getVideoConstraints=function(){return this.streamVideoConstraints},r.prototype.setVideoConstraints=function(t){this.streamVideoConstraints=t},r.prototype.getConstraints=function(){var t,r;return this.streamVideoConstraints||(t=this.getMediaDevices(),r="string"==typeof this.videoElement?document.getElementById(this.videoElement):this.videoElement,t&&r?e({video:{deviceId:{exact:r.deviceId},width:{min:640,ideal:1280,max:1920},height:{min:480,ideal:720,max:1080}}},{video:e({},this.streamVideoConstraints)}):e({video:e({},this.streamVideoConstraints)}))},r.prototype.getMediaDevices=function(){return navigator.mediaDevices||(navigator.mozGetUserMedia||navigator.webkitGetUserMedia?{getUserMedia:function(t){return new Promise((function(e,r){navigator.mozGetUserMedia?navigator.mozGetUserMedia(t,e,r):navigator.webkitGetUserMedia(t,e,r)}))}}:{getUserMedia:function(t){return new Promise((function(e,r){getUserMedia(t,e,r)}))}})},r.prototype.decodeFromConstraints=function(t,e,i){return r(this,void 0,void 0,(function(){var r,o,a;return n(this,(function(n){switch(n.label){case 0:this.videoElement=e,this.resultCallback=i,n.label=1;case 1:return n.trys.push([1,4,5,6]),[4,this.getMediaDevices()];case 2:return r=n.sent(),[4,r.getUserMedia(t)];case 3:return o=n.sent(),this.stream=o,this.videoElement.srcObject=o,this.videoElement.play(),this.running=!0,this.requestVideoFrame(),[3,6];case 4:throw a=n.sent(),a;case 5:return[7];case 6:return[2]}}))}))},r.prototype.decodeFromStream=function(t,e,i){return r(this,void 0,void 0,(function(){return n(this,(function(r){switch(r.label){case 0:return this.videoElement=e,this.resultCallback=i,this.stream=t,this.videoElement.srcObject=t,this.videoElement.play(),this.running=!0,this.requestVideoFrame(),[2]}}))}))},r.prototype.decodeFromVideoDevice=function(t,e,i){return r(this,void 0,void 0,(function(){var r,o,a,s;return n(this,(function(n){switch(n.label){case 0:this.videoElement="string"==typeof e?document.getElementById(e):e,this.resultCallback=i,n.label=1;case 1:return n.trys.push([1,6,,7]),[4,this.getMediaDevices()];case 2:if(r=n.sent(),o=null,null===t||void 0===t)return[4,this.findVideoDevice(r)];case 3:a=n.sent(),null!==(s=null==a?void 0:a.deviceId)&&(o={video:{deviceId:{exact:s}}}),n.label=4;case 4:return[4,r.getUserMedia(o)];case 5:return this.stream=n.sent(),this.videoElement.srcObject=this.stream,this.videoElement.play(),this.running=!0,this.requestVideoFrame(),[3,7];case 6:throw n.sent(),new at("Could not start video source.");case 7:return[2]}}))}))},r.prototype.findVideoDevice=function(t){return r(this,void 0,void 0,(function(){var e,r,i,o,a,s,c,l;return n(this,(function(n){switch(n.label){case 0:return[4,t.enumerateDevices()];case 1:return e=n.sent(),r=e.filter((function(t){return"videoinput"===t.kind})),[4,Promise.all(r.map((function(t){return t.getCapabilities?t.getCapabilities():null})))];case 2:for(i=n.sent(),o=0,a=0,s=0;s<r.length;s++)if(c=r[s],l=i[s],console.log(c.kind+": "+c.label+" id = "+c.deviceId+" capabilities = "+JSON.stringify(l)),l&&l.facingMode){var u="environment"===l.facingMode?-1:1;u<o&&(o=u,a=s)}return[2,r[a]]}}))}))},r.prototype.decodeFromImage=function(t,e){return r(this,void 0,void 0,(function(){var r;return n(this,(function(n){switch(n.label){case 0:return"string"!=typeof t&&"string"!=typeof e?[3,2]:(this.videoElement=document.getElementById(t),this.imageElement=document.getElementById(e),this.resultCallback=this.resultCallback,this.errCallback=this.errCallback,[2]);case 1:return[3,3];case 2:this.videoElement=t,this.imageElement=e,n.label=3;case 3:return[4,this.decodeFromImageUrl(this.imageElement.src)];case 4:return r=n.sent(),[2,r]}}))}))},r.prototype.decodeFromImageUrl=function(t){return r(this,void 0,void 0,(function(){var e,r;return n(this,(function(n){switch(n.label){case 0:return e=new tt,[4,this.createImage(t)];case 1:return r=n.sent(),[2,this.decodeFromImageElement(r)]}}))}))},r.prototype.createImage=function(t){return new Promise((function(e,r){var n=new Image;n.onload=function(){return e(n)},n.onerror=function(t){return r(t)},n.src=t}))},r.prototype.decodeFromImageElement=function(t){var e,r;if(this.videoElement){var n=this.videoElement;e=n.naturalWidth,r=n.naturalHeight}else{var i=this.imageElement;e=i.naturalWidth||i.width,r=i.naturalHeight||i.height}var o=document.createElement("canvas"),a=o.getContext("2d");a.drawImage(t,0,0,e,r);var s=a.getImageData(0,0,e,r);return this.decodeFromImageData(s)},r.prototype.decodeFromImageData=function(t){var e=t.width,r=t.height,n=new tt(e,r,void 0,void 0,void 0,t.data),i=new W(n);return ft.decode(i,this.hints)},r.prototype.decodeOnce=function(t,e){return this.reset(),this.decodeFromVideoDevice(void 0,t,e)},r.prototype.decodeContinuously=function(t,e,i){this.reset(),this.decodeFromVideoDevice(void 0,t,((function(t,r){i&&i(t,r),r||(this.time=0)})))},r.prototype.requestVideoFrame=function(){var t=this;if(this.running){try{var e=this.captureVideoFrame(this.videoElement,this.reader);this.resultCallback(e.getResult(),null)}catch(r){this.errCallback&&this.errCallback(r),r instanceof F||r instanceof j||(console.error("Got unexpected error "+r),this.stop())}this.time&&setTimeout((function(){return t.requestVideoFrame()}),this.time)}},r.prototype.captureVideoFrame=function(t,e){var r=document.createElement("canvas");return r.width=t.videoWidth,r.height=t.videoHeight,r.getContext("2d").drawImage(t,0,0,r.width,r.height),new T(new lt(r))},r.prototype.stop=function(){if(this.stream){this.running=!1,this.stream.getTracks().forEach((function(t){t.stop()}));var t=this.videoElement;t&&t.pause(),t.srcObject=null,this.stream=null,this.videoElement=null}},r.prototype.reset=function(){this.stop()},r.prototype.addVideoSource=function(t,e){var r=document.createElement("option");r.text=e,r.value=t,this.videoElement.appendChild(r)},r}(V),dt=function(t){function i(r,n,i){void 0===n&&(n=null),void 0===i&&(i=!1);var o=t.call(this,new C,n)||this;return o.tryHarder=i,o}return function(t,e){function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(i,t),i.prototype.decodeFromImage=function(t,e){return r(this,void 0,void 0,(function(){var r,i,o,a,s;return n(this,(function(n){switch(n.label){case 0:return"string"==typeof t?(this.imageElement=document.getElementById(t),this.imageElement.src=e):this.imageElement=t,[4,this.decodeFromImageUrl(this.imageElement.src)];case 1:return s=n.sent(),[2,s];case 2:return"string"!=typeof t||null==e?[3,4]:(this.imageElement=document.getElementById(t),this.imageElement.src=e,[2]);case 3:return[3,6];case 4:return[4,this.decodeFromImageUrl(t.src)];case 5:return r=n.sent(),[2,r];case 6:if("string"==typeof e)return this.imageElement=document.getElementById(t),[2];i=document.createElement("canvas"),o=i.getContext("2d"),i.width=e.width,i.height=e.height,o.drawImage(e,0,0,e.width,e.height);var c=new tt(e.width,e.height,4,null,null,i.getImageData(0,0,e.width,e.height).data);return a=new W(c),[2,this.reader.decode(a,this.hints)]}}))}))},i}(ut);!function(t){function r(r,i,o){var a=t.call(this,r,i,o)||this;return a.getMediaDevices=ut.prototype.getMediaDevices,a.decodeFromImage=dt.prototype.decodeFromImage,a.decodeFromImageUrl=ut.prototype.decodeFromImageUrl,a.createImage=ut.prototype.createImage,a.decodeFromImageElement=ut.prototype.decodeFromImageElement,a.decodeFromImageData=ut.prototype.decodeFromImageData,a.videoElement=a.videoElement,a}e(r,t),r.prototype.decode=function(t,e){return r.prototype.decodeFromVideoDevice.call(this,null,t,e)},r.prototype.decodeFromVideoElement=function(t,e,n){return r.prototype.decodeFromVideoDevice.call(this,t.deviceId,e,n)},r.prototype.decodeFrominputelement=function(t,e){var i=this;return r(this,void 0,void 0,(function(){var o;return n(this,(function(r){switch(r.label){case 0:return[4,i.decodeFromImage(e,t.target.files[0])];case 1:return o=r.sent(),[2,o]}}))}))},r.prototype.getStreamFromDevice=function(t,e){return r(this,void 0,void 0,(function(){var r,i;return n(this,(function(n){switch(n.label){case 0:return[4,this.getMediaDevices()];case 1:return r=n.sent(),[4,r.getUserMedia({video:{deviceId:{exact:e}}})];case 2:return i=n.sent(),[2,i]}}))}))},r.prototype.getStreamForConstraints=function(t){return r(this,void 0,void 0,(function(){var e,r;return n(this,(function(n){switch(n.label){case 0:return[4,this.getMediaDevices()];case 1:return e=n.sent(),[4,e.getUserMedia(t)];case 2:return r=n.sent(),[2,r]}}))}))},r.prototype.getVideoInputDevices=function(){return r(this,void 0,void 0,(function(){var t,e;return n(this,(function(r){switch(r.label){case 0:return[4,this.getMediaDevices()];case 1:return t=r.sent(),[4,t.enumerateDevices()];case 2:return e=r.sent(),[2,e.filter((function(t){return"videoinput"===t.kind}))]}}))}))},r.prototype.decodeOnceFromMock=function(t,e){var i=document.createElement("video");i.setAttribute("id",t.deviceId),document.body.appendChild(i);var o=document.createElement("canvas"),a=o.getContext("2d");o.width=t.width,o.height=t.height,a.drawImage(t,0,0,t.width,t.height);var s=new tt(t.width,t.height,4,null,null,o.getImageData(0,0,t.width,t.height).data),c=new W(s);return r.prototype.decode.call(this,c,this.hints)}};var i=ut;t.BrowserCodeReader=i,t.BrowserQRCodeReader=function(t){function r(r,n){return e(this,t),t.call(this,new C,r,n)||this}return r}(i),t.BrowserMultiFormatReader=function(t){function r(r,n){return e(this,t),t.call(this,new C,r,n)||this}return r}(i),t.BrowserDatamatrixCodeReader=function(t){function r(r,n){return e(this,t),t.call(this,new C,r,n)||this}return r}(i),t.BrowserAztecCodeReader=function(t){function r(r,n){return e(this,t),t.call(this,new C,r,n)||this}return r}(i),t.BrowserPDF417Reader=function(t){function r(r,n){return e(this,t),t.call(this,new C,r,n)||this}return r}(i),t.BrowserCode128Reader=function(t){function r(r,n){return e(this,t),t.call(this,new C,r,n)||this}return r}(i),t.BrowserCode93Reader=function(t){function r(r,n){return e(this,t),t.call(this,new C,r,n)||this}return r}(i),t.BrowserCode39Reader=function(t){function r(r,n){return e(this,t),t.call(this,new C,r,n)||this}return r}(i),t.BrowserEAN13Reader=function(t){function r(r,n){return e(this,t),t.call(this,new C,r,n)||this}return r}(i),t.BrowserEAN8Reader=function(t){function r(r,n){return e(this,t),t.call(this,new C,r,n)||this}return r}(i),t.BrowserITFReader=function(t){function r(r,n){return e(this,t),t.call(this,new C,r,n)||this}return r}(i),t.BrowserCodabarReader=function(t){function r(r,n){return e(this,t),t.call(this,new C,r,n)||this}return r}(i),t.BrowserUPCAReader=function(t){function r(r,n){return e(this,t),t.call(this,new C,r,n)||this}return r}(i),t.BrowserUPCEReader=function(t){function r(r,n){return e(this,t),t.call(this,new C,r,n)||this}return r}(i);var o=dt;t.BrowserImageCodeReader=o}(),Object.defineProperty(t,"__esModule",{value:!0})}));
        
        // --- MY APPLICATION SCRIPT, RUNNING IN THE SAME BLOCK ---
        document.addEventListener('DOMContentLoaded', function() {
            // --- Elements ---
            const tableBody = document.getElementById('table-body');
            const dateInput = document.getElementById('date');
            const printBtn = document.getElementById('print-btn');
            const clearBtn = document.getElementById('clear-btn');
            const scannerModal = document.getElementById('scanner-modal');
            const videoElement = document.getElementById('video');
            const closeScannerBtn = document.getElementById('close-scanner-btn');
            
            // --- Scanner variables ---
            let codeReader = null;
            let selectedInput = null;

            // --- Functions ---
            function createRow(rowData = ['', '', '']) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="text" class="input-cell" value="${rowData[0]}"></td>
                    <td><input type="text" class="input-cell" value="${rowData[1]}"></td>
                    <td>
                        <div class="input-container">
                            <input type="text" class="input-cell barcode-input" value="${rowData[2]}">
                            <button class="scan-btn">Scan</button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            }

            function checkAndAddRow() {
                const lastRow = tableBody.querySelector('tr:last-child');
                if (!lastRow) return;

                const inputs = lastRow.querySelectorAll('input');
                const isLastRowFilled = [...inputs].some(input => input.value.trim() !== '');

                if (isLastRowFilled) {
                    createRow();
                }
            }

            function saveData() {
                try {
                    const data = { date: dateInput.value, table: [] };
                    tableBody.querySelectorAll('tr').forEach(row => {
                        const rowData = [...row.querySelectorAll('.input-cell')].map(input => input.value);
                        if (rowData.some(cell => cell.trim() !== '')) {
                            data.table.push(rowData);
                        }
                    });
                    localStorage.setItem('sheetData', JSON.stringify(data));
                } catch (e) {
                    console.error("Error saving data:", e);
                }
                updateEmptyRowClasses();
            }

            function loadData() {
                tableBody.innerHTML = '';
                let savedData = null;
                try {
                    savedData = JSON.parse(localStorage.getItem('sheetData'));
                } catch (e) {
                    console.error("Error parsing saved data:", e);
                    localStorage.removeItem('sheetData'); // Clear corrupted data
                }
                
                dateInput.value = savedData?.date || new Date().toISOString().split('T')[0];

                if (savedData && Array.isArray(savedData.table)) {
                    savedData.table.forEach(rowData => createRow(rowData));
                }

                while (tableBody.rows.length < 2) {
                    createRow();
                }
                checkAndAddRow();
                updateEmptyRowClasses();
            }
            
            function updateEmptyRowClasses() {
                tableBody.querySelectorAll('tr').forEach(row => {
                    const isEmpty = ![...row.querySelectorAll('input')].some(input => input.value.trim() !== '');
                    row.classList.toggle('is-empty', isEmpty);
                });
            }

            function startScanner(event) {
                if (!event.target.classList.contains('scan-btn')) return;

                if (typeof ZXing === 'undefined') {
                    alert('Scanner cannot be initialized. This might be due to a browser incompatibility. The rest of the page will work normally.');
                    return;
                }

                if (!codeReader) {
                    codeReader = new ZXing.BrowserMultiFormatReader();
                }
                
                selectedInput = event.target.closest('.input-container').querySelector('input');
                scannerModal.classList.add('is-visible');

                codeReader.decodeFromVideoDevice(undefined, 'video', (result, err) => {
                    if (result) {
                        selectedInput.value = result.text;
                        stopScanner();
                        tableBody.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                }).catch(err => {
                    console.error("Scanner Error:", err);
                    alert('Could not start camera. Please make sure you have granted camera permission in your browser settings.');
                    stopScanner();
                });
            }

            function stopScanner() {
                if (codeReader) {
                    codeReader.reset();
                }
                scannerModal.classList.remove('is-visible');
            }

            // --- Event Listeners ---
            printBtn.addEventListener('click', () => window.print());
            clearBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to erase all data?')) {
                    localStorage.removeItem('sheetData');
                    loadData();
                }
            });

            closeScannerBtn.addEventListener('click', stopScanner);
            tableBody.addEventListener('click', startScanner);
            tableBody.addEventListener('input', () => {
                saveData();
                checkAndAddRow();
            });
            dateInput.addEventListener('change', saveData);

            // --- Initial Setup ---
            loadData();
        });
    </script>
</body>
</html>
